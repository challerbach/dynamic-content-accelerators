"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){var n,s=["interflora-templateChooser","acc-template-navigation","acc-template-navigation-slot","acc-template-flexible-slot","acc-template-image-poi","acc-template-rich-text","acc-template-curated-product-list-ct","image-src","source","acc-template-banner-personalised","acc-template-landing-page","acc-template-algolia-personalised-content","acc-template-algolia-search","acc-template-card-interflora","acc-template-cardList-interflora"],r=s.length,e=function(t,e){var a,n,o=window.location.search.substring(1).split("&");for(n=0;n<o.length;n++)if((a=o[n].split("="))[0]===t)return void 0===a[1]||decodeURIComponent(a[1]);if(e)return e},c=e("vse","emilydemo.cdn.content.amplience.net"),l=e("key","interflora/web/home"),d=e("menukey","interflora/web/navigation"),p=e("locale","en-US,en-*,*"),u=(e("segment",""),e("cid")),m=e("hidemenu","false");m="true"==m;var a,o,f,i,g=window.btoa("u1dO23i5JuRIRllKMk9NOCVV:VwxflHqzerWZvlyNenAzCZGgfhZQ0uRc");function h(a){var n=[].slice.call(a.querySelectorAll(".amp-dc-promo-block")),o=2,i=window.innerWidth;if(n.length<2)n[0].classList.add("dc-fade-in");else{n.forEach(function(t){n[o-1].classList.remove("dc-fade-in")}),n[o-1].classList.add("dc-fade-in");setInterval(function(){i=window.innerWidth;var t=[].slice.call(a.querySelectorAll(".dc-fade-in"));if(!(768<i)){var e=(o===n.length?o=1:o+=1,o-1);0<t.length&&t.forEach(function(t){t.classList.remove("dc-fade-in")}),n[e].classList.add("dc-fade-in")}},5e3)}}function v(t){var e={infinite:"true"===t.getAttribute("data-infinite")?1:0,navigation:"true"===t.getAttribute("data-navigation"),autoplay:"true"===t.getAttribute("data-autoplay")},a=(window.lory?window.lory:"function"==typeof require?require("lory.js").lory:null)(t,e);e.infinite||this.disableNavButtons(t,a),e.navigation&&this.navigationDots(t,a,e),this.enableSwipeGesturesOnVideo(t)}function y(t,e){[].slice.call(document.querySelectorAll(t)).forEach(function(t){t.component||(t.component=new e(t))})}function w(){var t=document.getElementById("card-container");if(!t)return!1;var e,a=t.childNodes[0].nextSibling,n=a.clientHeight,o=t.clientHeight;1.5<n/o&&(i&&clearInterval(i),i=setInterval(function(){t.classList.remove("transition"),e=a.style.top||0,e=parseInt(e),Math.abs(parseInt(e))+o<n?(e-=1,e+="px",a.style.top=e):(clearInterval(i),setTimeout(b,1e3))},10))}function b(){var t=document.getElementById("card-container"),e=t.childNodes[0].nextSibling;t.classList.add("with-transition"),setTimeout(function(){e.style.top="0px",t.classList.remove("with-transition"),t.classList.add("transition"),clearInterval(i)},1e3)}function x(){var i;if(e("template"))return y(".amp-dc-promo-banner",h),y(".amp-dc-slider",v),S(),E(),void L();s.forEach(function(t,e){var o,a="Loading Partial "+(e+1)+"/"+r+" : "+t;$("#loader-text").html(a),console.log(a),o=t,$.ajax({url:"https://presalesadisws.s3.eu-west-1.amazonaws.com/dynamic-content/accelerators/interflora/templates/"+o+".html",dataType:"html",cache:!0,success:function(t){Handlebars.registerPartial(o,t),s=_.without(s,o);var e="Registered Partial : "+o+". "+s.length+" left to load";if($("#loader-text").html(e),console.log(e),s.length<1){var e="Files Loaded - loading content...";if($("#loader-text").html(e),console.log(e),i=Handlebars.compile("{{> interflora-templateChooser this}}"),!m){var a="https://"+c+"/content/key/"+d+"?locale="+p;$.getJSON(a,{format:"inlined",depth:"all"}).done(function(t){var e=i(t.content);console.log(e),$("#amp-menu-holder").html(e)})}var n="https://"+c+"/content/key/"+l;u&&(n="https://"+c+"/content/id/"+u),$.getJSON(n+"?locale="+p,{format:"inlined",depth:"all"}).done(function(t){$("#loader-text").html("DONE!"),console.log("DONE!");var e=i(t.content);console.log(e),$("#amp-page-content-holder").html(e),y(".amp-dc-promo-banner",h),y(".amp-dc-slider",v),S(),E(),L()})}}})})}function S(){var t=window.poiDefaults||{domain:"https://"+c,account:"presales",containerClass:"amp-dc-poi-image",imgClass:"amp-dc-image-pic",images:[{name:"*",polygonCallbacks:[{target:"*",action:"click",callback:function(t,e){console.log("generic click",e)},initCallback:function(t){console.log("init callback polygon",t)}}],hotspotCallbacks:[{target:"*",action:"click",callback:function(t,e){console.log("yay, i was clicked :)",e)},initCallback:function(t){console.log("init callback hotspot",t)}},{target:"*",action:"mouseover",callback:function(t,e){console.log("yay, i was hovered :)",e)},initCallback:function(t){console.log("init callback hotspot",t)}}]}]};new window.POI(t).init()}function A(e){console.log("authenticating"),$.ajax({url:"https://auth.europe-west1.gcp.commercetools.com/oauth/token",method:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded",data:{grant_type:"client_credentials",scope:"view_published_products:anyafinn"},cache:!1,beforeSend:function(t){t.setRequestHeader("Authorization","Basic "+g)},success:function(t){console.log("Success"),console.log(t),n=t.access_token,e()},error:function(t,e,a){console.log("error"),console.log(t,e,a)}})}function C(){a.forEach(function(s){var r=s.getAttribute("data-amp-product-code");$.ajax({url:"https://api.europe-west1.gcp.commercetools.com/anyafinn/product-projections/"+r+"?localeProjection=en",method:"GET",dataType:"json",context:s,cache:!1,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+n)},success:function(t){console.log("Success"),console.log(t);try{var e=t.masterVariant.sku,a=t.masterVariant.images[0].url,n=t.name.en,o=t.masterVariant.prices[0].value,i='<a class="amp-dc-card-wrap" href="'+e+'"><div class="amp-dc-card-wrap"><div class="amp-dc-card-img-wrap"><picture class="amp-dc-image"><img src="'+a+'?$product-list$" class="amp-dc-image-pic"/></picture></div><div class="amp-dc-card-text-wrap"><div class="amp-dc-card-name">'+n+'</div><p class="amp-dc-card-description"></p><div class="amp-dc-card-link">'+("&pound;"+(.1*o.centAmount).toFixed(o.fractionDigits))+"</div></div></a></div>";s.innerHTML=i}catch(t){console.log("Error with CommerceTools Product:"+r);i='<a class="amp-dc-card-wrap" href="#"><div class="amp-dc-card-wrap"><div class="amp-dc-card-img-wrap"><picture class="amp-dc-image"><img src="https://i8.amplience.net/s/willow/noimagefound?$product-list$" class="amp-dc-image-pic"/></picture></div><div class="amp-dc-card-text-wrap"><div class="amp-dc-card-name">Product: '+r+' not found</div><p class="amp-dc-card-description">Please select another</p><div class="amp-dc-card-link"></div></div></a></div>';$(s).html(i)}},error:function(t,e,a){console.log("error"),console.log(t,e,a)}})})}function k(){o.forEach(function(i){var t=i.getAttribute("data-amp-product-search"),e=i.getAttribute("data-amp-product-limit"),a=i.getAttribute("data-amp-product-ignores");a&&(a=JSON.parse(a)),console.log(a),$.ajax({url:"https://api.europe-west1.gcp.commercetools.com/{CT_PROJECT_KEY/product-projections/search?staged=false&fuzzy=true&limit="+e+'&text.en="'+t+'"',method:"GET",dataType:"json",context:i,cache:!1,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+n)},success:function(t){(console.log("Success"),console.log(t),t&&0<t.count)&&t.results.forEach(function(e){try{if(!e.name["en-CA"])return;var t=e.masterVariant.attributes.find(function(t){return"webBrandName"===t.name}).value["en-CA"],a=e.masterVariant.attributes.find(function(t){return"largeImageUrl"===t.name}).value;if(0<=a.indexOf("http://")&&(a=a.replace("http://","https://")),a.indexOf("images.ulta.com")<0)return;var n=e.masterVariant.prices[0].value.centAmount;n=(n/=100).toLocaleString("en-US",{style:"currency",currency:"USD"});var o='<div class="amp-dc-prod-card"><a class="amp-dc-card-wrap" href=" https://www.ulta.com/amplience-link?productId='+e.key+'"><div class="amp-dc-card-wrap"><div class="amp-dc-card-img-wrap"><picture class="amp-dc-image"><img src="'+a+'" class="amp-dc-image-pic"/></picture></div><div class="amp-dc-card-text-wrap"><div class="amp-dc-card-name">'+e.name["en-CA"]+'</div><p class="amp-dc-card-description">'+t+'</p><div class="amp-dc-card-link">'+n+"</div></div></a></div></div>";$(i).append(o)}catch(t){console.log("Error with CommerceTools Product:"+e.key)}})},error:function(t,e,a){console.log("error"),console.log(t,e,a)}})})}function E(){1<=(a=document.querySelectorAll("[data-amp-product-code]")).length&&A(C),1<=(o=document.querySelectorAll("[data-amp-product-search]")).length&&A(k)}function L(){f=algoliasearch("T7I8W0D1V2","c572522c02c617013a1f53c1fa9968e5"),document.querySelectorAll("[data-amp-index-name]").forEach(function(a){var t=a.getAttribute("data-amp-index-name");console.log("ALGOLIA INDEX TO USE: "+t);var e=a.getAttribute("data-amp-query"),n=a.getAttribute("data-amp-attributes"),o=f.initIndex(t),i={hitsPerPage:1};n&&(i.attributesToRetrieve=n),o.search(e,i).then(function(t){var e=t.hits;console.log("QUERY RESPONSE:"),console.log(e),console.log(a),e[0]&&$(a).load(e[0].ampURLHTML)})})}function O(){document.getElementById("card-container")?(y(".amp-dc-promo-banner",h),y(".amp-dc-slider",v),S(),setTimeout(w,2e3)):x()}v.prototype.disableNavButtons=function(t,a){var n=Array.prototype.slice.call(t.querySelectorAll(".js_dc_slide"),0),o=t.querySelector(".js_prev"),i=t.querySelector(".js_next"),s="ctrl-disabled";if(!o&&!i)return!1;var e=function(t){var e=a.returnIndex();0===e?(o.classList.add(s),i.classList.remove(s)):e===n.length-1?(o.classList.remove(s),i.classList.add(s)):(o.classList.remove(s),i.classList.remove(s))};0===a.returnIndex()&&o.classList.add(s),t.addEventListener("after.lory.slide",e),t.addEventListener("on.lory.resize",e)},v.prototype.autoslide=function(t,e){var a,n=function(){e.next()};return{start:function(){a=setInterval(n,3e3)},stop:function(){clearTimeout(a)},init:function(){this.start()}}},v.prototype.navigationDots=function(t,a,n){var o=Array.prototype.slice.call(t.querySelectorAll(".js_dc_slider_dot"),0),i=n.autoplay&&new this.autoslide(t,a);o.forEach(function(t,e){0===e&&(t.classList.add("active"),i&&i.init(t)),t.addEventListener("click",function(t){a.slideTo(e)})}),t.addEventListener("after.lory.slide",function(t){o.forEach(function(t,e){t.classList.remove("active")}),console.log(n);var e=n.infinite?t.detail.currentSlide-1:t.detail.currentSlide;o[e].classList.add("active"),i&&i.stop(),i&&i.start()})},v.prototype.enableSwipeGesturesOnVideo=function(t){if(navigator.userAgent.match(/Android/i)){var e=t.querySelectorAll(".amp-dc-slider .amp-dc-video");(e=Array.prototype.slice.call(e,0)).forEach(function(t,e){var a=document.createElement("div");a.style.width=t.clientWidth+"px",a.style.height=t.clientHeight-30+"px",a.style.marginBottom=30-t.clientHeight+"px",a.className="inactive-video",t.parentNode.parentNode.insertBefore(a,t.parentNode),a.addEventListener("click",function(){a.classList.add("no-overlay"),t.play()}),t.addEventListener("pause",function(){a.classList.remove("no-overlay")}),window.addEventListener("resize",function(){a.style.width=t.clientWidth+"px",a.style.height=t.clientHeight-30+"px",a.style.marginBottom=30-t.clientHeight+"px"})})}},t.Utils=t.Utils||{},t.Utils.attachComponents=O,t.Utils.evaluateAmplienceMenuLink=function(t){if(console.log("link clicked = "+t),0<=t.indexOf("https://"))window.open(t,"_self");else{var e=window.location.href;if(0<=e.indexOf("&key=")){for(var a=e.split("&"),n=0;n<a.length;n++)0==a[n].indexOf("key=")&&(a[n]="key="+t);var o=a.join("&");window.open(o,"_self")}else 0<=e.indexOf("?")?window.open(e+"&key="+t,"_self"):window.open(e+"?key="+t,"_self")}},t.Utils.searchClient=f,window.addEventListener("load",function(){O()})}(window.AmpCa=window.AmpCa||{}),window.POI=function(t){this.images=[],this.imgsLoaded=0,this.params=t},window.POI.prototype={generateData:function(t,e){var a,n=this.getHotspots(t.data);if(null!==n){var o=this.findImg(t.img,e);a={dimensions:{width:t.data.width,height:t.data.height},$img:o,data:t.img,name:t.img.name,points:n,svg:null},this.images.push(a)}this.imgsLoaded+=1,t.callback(a)},getImgData:function(o){for(var i=this,s=this.params.images,r=document.querySelectorAll("img."+this.params.imgClass),c=Array.apply(null,r),l=function(n){i.ajax.atomic(i.params.domain+"/i/"+i.params.account+"/"+n.name+".json?metadata=true&func=amp.jsonReturn&v="+(new Date).getTime()).then(function(t){var e=t.data,a=i.clone(c);i.findAllImages(n,a).forEach(function(){i.generateData({data:e,img:n,callback:function(t){o(t)}},c)})})},t=0;t<s.length;t++)!function(){var a=t;if("*"===s[a].name)for(var n=0;n<r.length;n++)!function(){var e,t=r[n].getAttribute("src").split("?");if(e=(e=(e=t[0].split(i.params.account+"/"))[e.length-1].split("/"))[0],s.find(function(t){return t.name===e}))return;l({name:e,hotspotCallbacks:s[a].hotspotCallbacks,polygonCallbacks:s[a].polygonCallbacks})}();else s[a].data?i.generateData({data:s[a].data,img:s[a],callback:function(t){o(t)}},c):l(s[a])}()},findAllImages:function(t,e){for(var a=this.params.imgAttribute||"src",n=[],o=0;o<e.length;o++){var i=new RegExp(t.name),s=e[o].getAttribute(a).match(i);s&&0<s.length&&n.push(e[o])}return n},findImg:function(t,e){for(var a=this.params.imgAttribute||"src",n=null,o=0;o<e.length;o++){var i=new RegExp(t.name),s=e[o].getAttribute(a).match(i);if(s&&0<s.length){n=e[o],e.splice(o,1);break}}return n},getHotspots:function(t){var e=null;t.constructor!==Array&&(t=[t]);for(var a=0;a<t.length;a++)t[a]&&t[a].metadata&&t[a].metadata.hotSpots&&t[a].metadata.hotSpots.constructor===Object&&t[a].metadata.hotSpots.hotSpots&&t[a].metadata.hotSpots.hotSpots.constructor===Object&&t[a].metadata.hotSpots.hotSpots.list&&0<t[a].metadata.hotSpots.hotSpots.list.length&&(e=t[a].metadata.hotSpots.hotSpots.list);return e},iteratePoints:function(t){if(t)for(var e=this.hotspots(),a=this.polygons(),n=t.points,o=0;o<n.length;o++)n[o].points.constructor===Array?a.create(n[o],t):e.create(n[o],t)},assignEvents:function(t,a,n,o){if(n&&0<n.length)for(var i=0;i<n.length;i++)!function(){var e=n[i];e.target!==a&&"*"!==e.target||(t.addEventListener(e.action,function(t){e.callback(t,o)},!1),e.initCallback&&e.initCallback(o))}()},init:function(){var e=this;this.getImgData(function(t){e.iteratePoints(t)})},clone:function(t){if(null==t||"object"!=_typeof(t))return t;var e=t.constructor();for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e}},"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=POI),POI.prototype.dom={hasClass:function(t,e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(t.className)},getClosest:function(t,e){var a,n,o=e.charAt(0),i="classList"in document.documentElement;for("["===o&&(1<(a=(e=e.substr(1,e.length-2)).split("=")).length&&(n=!0,a[1]=a[1].replace(/"/g,"").replace(/'/g,"")));t&&t!==document&&1===t.nodeType;t=t.parentNode){if("."===o)if(i){if(t.classList.contains(e.substr(1)))return t}else if(new RegExp("(^|\\s)"+e.substr(1)+"(\\s|$)").test(t.className))return t;if("#"===o&&t.id===e.substr(1))return t;if("["===o&&t.hasAttribute(a[0])){if(!n)return t;if(t.getAttribute(a[0])===a[1])return t}if(t.tagName.toLowerCase()===e)return t}return null}},POI.prototype.hotspots=function(){var l=this;return{create:function(t,e){var a=e.data.hotspotCallbacks,n=document.createElement("div"),o=t.selector,i=t.target;if(o){0===o.indexOf(".")?(o=o.slice(1),n.setAttribute("class",o)):0===o.indexOf("#")?(o=o.slice(1),n.setAttribute("id",o)):n.setAttribute("class",o),n.setAttribute("data-type","poi-hotspot");var s=l.dom.getClosest(e.$img,"."+l.params.containerClass);if(s&&l.dom.hasClass(s,l.params.containerClass)){var r=t.points.x.toString().slice(2);r=r.substr(0,2)+"."+r.substr(2);var c=t.points.y.toString().slice(2);c=c.substr(0,2)+"."+c.substr(2),n.style.position="absolute",n.style.left=r+"%",n.style.top=c+"%",s.style.position="relative",s.appendChild(n),i&&0<i.length&&(n.setAttribute("data-target",i),l.assignEvents(n,i,a,{$image:e.$img,$target:n,$parent:s,hotspot:t,imgInfo:e}))}else console.warn("No parent with specified className "+l.params.containerClass+" was found.")}else console.warn("no selector specified")}}},POI.prototype.polygons=function(){var p=this;return{create:function(t,e){var a=e.data.polygonCallbacks,n=t.selector;if(n){var o,i=t.target,s=p.dom.getClosest(e.$img,"."+p.params.containerClass),r="http://www.w3.org/2000/svg",c=document.createElementNS(r,"g"),l=document.createElementNS(r,"polygon");if(e.svg?o=e.svg:((o=document.createElementNS(r,"svg")).setAttributeNS(null,"viewBox","0 0 "+e.dimensions.width+" "+e.dimensions.height),s.appendChild(o),e.svg=o),0===n.indexOf(".")?(n=n.slice(1),l.setAttributeNS(null,"class",n)):0===n.indexOf("#")?(n=n.slice(1),l.setAttributeNS(null,"id",n)):l.setAttributeNS(null,"class",n),s&&p.dom.hasClass(s,p.params.containerClass)){var d="";t.points.forEach(function(t){d+=e.dimensions.width*t.x+","+e.dimensions.height*t.y+" "}),l.setAttributeNS(null,"points",d),o.appendChild(c),c.appendChild(l),i&&0<i.length&&(l.setAttributeNS(null,"data-target",i),p.assignEvents(c,i,a,{$image:e.$img,$target:c,$parent:s,polygon:t,imgInfo:e}))}else console.warn("No parent with specified className "+p.params.containerClass+" was found.")}else console.warn("no selector specified")}}},POI.prototype.ajax={settings:null,defaults:{method:"GET",username:null,password:null,data:{},headers:{"Content-type":"application/x-www-form-urlencoded"},responseType:"text",timeout:null,withCredentials:!1},supports:function(){return"XMLHttpRequest"in window&&"JSON"in window&&"Promise"in window},extend:function(){for(var a=this,n={},t=0;t<arguments.length;t++){!function(t){for(var e in t)t.hasOwnProperty(e)&&("[object Object]"===Object.prototype.toString.call(t[e])?n[e]=a.extend(n[e],t[e]):n[e]=t[e])}(arguments[t])}return n},parse:function(e){var a;if("text"!==this.settings.responseType&&""!==this.settings.responseType)return{data:e.response,xhr:e};try{a=JSON.parse(e.responseText)}catch(t){a=e.responseText}return{data:a,xhr:e}},param:function(t){if("string"==typeof t||"[object FormData]"===Object.prototype.toString.call(t))return t;if(/application\/json/i.test(this.settings.headers["Content-type"])||"[object Array]"===Object.prototype.toString.call(t))return JSON.stringify(t);var e=[];for(var a in t)t.hasOwnProperty(a)&&e.push(encodeURIComponent(a)+"="+encodeURIComponent(t[a]));return e.join("&")},makeRequest:function(n){var o=new XMLHttpRequest,i=this,t=new Promise(function(t,e){for(var a in o.onreadystatechange=function(){4===o.readyState&&(200<=o.status&&o.status<300?t(i.parse(o)):e({status:o.status,statusText:o.statusText,responseText:o.responseText}))},o.open(i.settings.method,n,!0,i.settings.username,i.settings.password),o.responseType=i.settings.responseType,i.settings.headers)i.settings.headers.hasOwnProperty(a)&&o.setRequestHeader(a,i.settings.headers[a]);i.settings.timeout&&(o.timeout=i.settings.timeout,o.ontimeout=function(t){e({status:408,statusText:"Request timeout"})}),i.settings.withCredentials&&(o.withCredentials=!0),o.send(i.param(i.settings.data))});return t.cancel=function(){o.abort()},t},atomic:function(t,e){if(!this.supports())throw"Atomic: This browser does not support the methods used in this plugin.";return this.settings=this.extend(this.defaults,e||{}),this.makeRequest(t)}};